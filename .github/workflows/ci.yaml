name: Java chat CI

on: push

jobs:
  backend:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-java@v3
        with:
          java-version: '19'
          distribution: 'corretto'
          cache: 'maven'
      - name: Build/test with Maven
        run: |
          mvn install -DskipTests
          mvn test -P no-client-tests

  client-chat-form:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-java@v3
        with:
          java-version: '19'
          distribution: 'corretto'
          cache: 'maven'
      - name: Set up Xvfbc
        run: |
          sudo apt-get update
          sudo apt-get install xvfb sawfish
          sudo apt-get install at-spi2-core
          ls -l /usr/bin/java
      - name: Build/test with Maven
        run: |
          Xvfb :99 -screen 0 1920x1200x24 &
          export DISPLAY=:99
          sleep 5
          sawfish --display=:99.0 &
          mvn install -DskipTests 
          mvn test -Dtest="ChatFormTest" -pl client

  client-configure-chat-form:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-java@v3
        with:
          java-version: '19'
          distribution: 'corretto'
          cache: 'maven'
      - name: Set up Xvfbc
        run: |
          sudo apt-get update
          sudo apt-get install xvfb
          sudo apt-get install at-spi2-core
      - name: Build/test with Maven
        run: |
          Xvfb :99 &
          export DISPLAY=:99
          mvn install -DskipTests 
          mvn test -Dtest="ConfigureChatFormTest" -pl client

  client-create-chat-form:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-java@v3
        with:
          java-version: '19'
          distribution: 'corretto'
          cache: 'maven'
      - name: Set up Xvfbc
        run: |
          sudo apt-get update
          sudo apt-get install xvfb
          sudo apt-get install at-spi2-core
      - name: Build/test with Maven
        run: |
          Xvfb :99 &
          export DISPLAY=:99
          mvn install -DskipTests 
          mvn test -Dtest="CreateChatFormTest" -pl client

  client-forgot-password-form:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-java@v3
        with:
          java-version: '19'
          distribution: 'corretto'
          cache: 'maven'
      - name: Set up Xvfbc
        run: |
          sudo apt-get update
          sudo apt-get install xvfb
          sudo apt-get install at-spi2-core
      - name: Build/test with Maven
        run: |
          Xvfb :99 &
          export DISPLAY=:99
          mvn install -DskipTests 
          mvn test -Dtest="ForgotPasswordFormTest" -pl client

  client-forward-message-form:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-java@v3
        with:
          java-version: '19'
          distribution: 'corretto'
          cache: 'maven'
      - name: Set up Xvfbc
        run: |
          sudo apt-get update
          sudo apt-get install xvfb
          sudo apt-get install at-spi2-core
      - name: Build/test with Maven
        run: |
          Xvfb :99 &
          export DISPLAY=:99
          mvn install -DskipTests 
          mvn test -Dtest="ForwardMessageFormTest" -pl client

  client-login-form:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-java@v3
        with:
          java-version: '19'
          distribution: 'corretto'
          cache: 'maven'
      - name: Set up Xvfbc
        run: |
          sudo apt-get update
          sudo apt-get install xvfb sawfish
          sudo apt-get install at-spi2-core
      - name: Build/test with Maven
        run: |
          Xvfb :99 -screen 0 1920x1200x24 &
          export DISPLAY=:99
          sleep 5
          sawfish --display=:99.0 &
          mvn install -DskipTests 
          mvn test -Dtest="LoginFormTest" -pl client

  client-profile-form:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-java@v3
        with:
          java-version: '19'
          distribution: 'corretto'
          cache: 'maven'
      - name: Set up Xvfbc
        run: |
          sudo apt-get update
          sudo apt-get install xvfb
          sudo apt-get install at-spi2-core
      - name: Build/test with Maven
        run: |
          Xvfb :99 &
          export DISPLAY=:99
          mvn install -DskipTests 
          mvn test -Dtest="ProfileFormTest" -pl client

  client-properties:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-java@v3
        with:
          java-version: '19'
          distribution: 'corretto'
          cache: 'maven'
      - name: Set up Xvfbc
        run: |
          sudo apt-get update
          sudo apt-get install xvfb
          sudo apt-get install at-spi2-core
      - name: Build/test with Maven
        run: |
          Xvfb :99 &
          export DISPLAY=:99
          mvn install -DskipTests 
          mvn test -Dtest="PropertiesTest" -pl client

  system-chat-find:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-java@v3
        with:
          java-version: '19'
          distribution: 'corretto'
          cache: 'maven'
      - name: Set up Xvfbc
        run: |
          sudo apt-get update
          sudo apt-get install xvfb
          sudo apt-get install at-spi2-core
      - name: Build/test with Maven
        run: |
          Xvfb :99 &
          export DISPLAY=:99
          mvn clean package -Psystem -DfailIfNoTests=false -Dtest="TestChatFind" -am

  system-create-chat:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-java@v3
        with:
          java-version: '19'
          distribution: 'corretto'
          cache: 'maven'
      - name: Set up Xvfbc
        run: |
          sudo apt-get update
          sudo apt-get install xvfb
          sudo apt-get install at-spi2-core
      - name: Build/test with Maven
        run: |
          Xvfb :99 &
          export DISPLAY=:99
          mvn clean package -Psystem -DfailIfNoTests=false -Dtest="TestCreateChat" -am

  system-exit-user:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-java@v3
        with:
          java-version: '19'
          distribution: 'corretto'
          cache: 'maven'
      - name: Set up Xvfbc
        run: |
          sudo apt-get update
          sudo apt-get install xvfb
          sudo apt-get install at-spi2-core
      - name: Build/test with Maven
        run: |
          Xvfb :99 &
          export DISPLAY=:99
          mvn clean package -Psystem -DfailIfNoTests=false -Dtest="TestExitUser" -am

  system-message-forward:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-java@v3
        with:
          java-version: '19'
          distribution: 'corretto'
          cache: 'maven'
      - name: Set up Xvfbc
        run: |
          sudo apt-get update
          sudo apt-get install xvfb
          sudo apt-get install at-spi2-core
      - name: Build/test with Maven
        run: |
          Xvfb :99 &
          export DISPLAY=:99
          mvn clean package -Psystem -DfailIfNoTests=false -Dtest="TestMessageForward" -am

  system-non-existing-user-add:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-java@v3
        with:
          java-version: '19'
          distribution: 'corretto'
          cache: 'maven'
      - name: Set up Xvfbc
        run: |
          sudo apt-get update
          sudo apt-get install xvfb
          sudo apt-get install at-spi2-core
      - name: Build/test with Maven
        run: |
          Xvfb :99 &
          export DISPLAY=:99
          mvn clean package -Psystem -DfailIfNoTests=false -Dtest="TestNonExistingUserAdd" -am

  system-register-already-exists:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-java@v3
        with:
          java-version: '19'
          distribution: 'corretto'
          cache: 'maven'
      - name: Set up Xvfbc
        run: |
          sudo apt-get update
          sudo apt-get install xvfb
          sudo apt-get install at-spi2-core
      - name: Build/test with Maven
        run: |
          Xvfb :99 &
          export DISPLAY=:99
          mvn clean package -Psystem -DfailIfNoTests=false -Dtest="TestRegisterAlreadyExists" -am

  system-send-message:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-java@v3
        with:
          java-version: '19'
          distribution: 'corretto'
          cache: 'maven'
      - name: Set up Xvfbc
        run: |
          sudo apt-get update
          sudo apt-get install xvfb
          sudo apt-get install at-spi2-core
      - name: Build/test with Maven
        run: |
          Xvfb :99 &
          export DISPLAY=:99
          mvn clean package -Psystem -DfailIfNoTests=false -Dtest="TestSendMessage" -am

  system-set-admin-after-exit:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-java@v3
        with:
          java-version: '19'
          distribution: 'corretto'
          cache: 'maven'
      - name: Set up Xvfbc
        run: |
          sudo apt-get update
          sudo apt-get install xvfb
          sudo apt-get install at-spi2-core
      - name: Build/test with Maven
        run: |
          Xvfb :99 &
          export DISPLAY=:99
          mvn clean package -Psystem -DfailIfNoTests=false -Dtest="TestSetAdminAfterExit" -am

  system-set-user-admin:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-java@v3
        with:
          java-version: '19'
          distribution: 'corretto'
          cache: 'maven'
      - name: Set up Xvfbc
        run: |
          sudo apt-get update
          sudo apt-get install xvfb
          sudo apt-get install at-spi2-core
      - name: Build/test with Maven
        run: |
          Xvfb :99 &
          export DISPLAY=:99
          mvn clean package -Psystem -DfailIfNoTests=false -Dtest="TestSetUserAdmin" -am

  system-successful-register:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-java@v3
        with:
          java-version: '19'
          distribution: 'corretto'
          cache: 'maven'
      - name: Set up Xvfbc
        run: |
          sudo apt-get update
          sudo apt-get install xvfb
          sudo apt-get install at-spi2-core
      - name: Build/test with Maven
        run: |
          Xvfb :99 &
          export DISPLAY=:99
          mvn clean package -Psystem -DfailIfNoTests=false -Dtest="TestSuccessfulRegister" -am